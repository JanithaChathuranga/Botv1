// Klo mau pake, pake aja ini bkn enc cma terser aja

import fetch from"node-fetch";export async function before(m){if(this.autogpt=this.autogpt?this.autogpt:{},m.isBaileys||!this.autogpt.status||!m.text)return!1;let text=m.text;if(text)try{if(text.includes("gpt")||text.includes("chatgpt")){const startIdx=Math.max(text.indexOf("gpt"),text.indexOf("chatgpt"))+2,inputText=text.substring(startIdx).trim(),result=await gptGo(inputText);result&&await this.reply(m.chat,result,m)}else text.startsWith("off")&&(this.autogpt.status=!1,await this.reply(m.chat,"*Chatgpt OFF*",m))}catch{await this.reply(m.chat,"Error occurred.",m)}}async function gptGo(query){const encodeQuery=encodeURIComponent(query),tokenResponse=await fetch(`https://gptgo.ai/action_get_token.php?q=${encodeQuery}&hlgpt=id`,{method:"GET",headers:{Referer:"https://gptgo.ai/?hl=id",origin:"https://gptgo.ai/"}}),{token:token}=await tokenResponse.json(),response=await fetch(`https://gptgo.ai/action_ai_gpt.php?token=${token}`,{method:"GET",headers:{Referer:"https://gptgo.ai/?hl=id",origin:"https://gptgo.ai/",accept:"text/event-stream"}}),chunks=(await response.text()).split("data:");let result="";for(let i=1;i<chunks.length;i++){const chunk=chunks[i].trim(),doneIndex=chunk.indexOf("[DONE]");if(-1!==doneIndex){result+=chunk.slice(0,doneIndex);break}const contentIndex=chunk.indexOf('"content":"');if(-1!==contentIndex){const startIndex=contentIndex+11,endIndex=chunk.indexOf('"',startIndex);if(-1!==endIndex){result+=chunk.slice(startIndex,endIndex)}}}return result.replace(/\\n/g,"\n")}