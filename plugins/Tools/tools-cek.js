// Klo mau pake, pake aja ini bkn enc cma terser aja

import fetch from"node-fetch";let handler=async(m,{conn:conn,usedPrefix:usedPrefix})=>{let q=m.quoted?m.quoted:m,mime=(q.msg||q).mimetype||"";if(!mime)throw`Reply Foto/Kirim Foto Dengan Caption ${usedPrefix}wait`;if(!/image\/(jpe?g|png)/.test(mime))throw`Mime ${mime} tidak support`;let img=await q.download();await m.reply("Searching Anime Titles...");let anime=`data:${mime};base64,${img.toString("base64")}`,response=await fetch("https://trace.moe/api/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:anime})});if(!response.ok)throw"Gambar tidak ditemukan!";let result=await response.json(),{is_adult:is_adult,title:title,title_chinese:title_chinese,title_romaji:title_romaji,episode:episode,season:season,similarity:similarity,filename:filename,at:at,tokenthumb:tokenthumb,anilist_id:anilist_id}=result.docs[0],link=`https://media.trace.moe/video/${anilist_id}/${encodeURIComponent(filename)}?t=${at}&token=${tokenthumb}`,nobuyaki=`\n${similarity<.89?"Saya Memiliki Keyakinan Rendah Tentang Hal Ini":""}\n\n❏ Judul Jepang : *${title}*\n❏ Ejaan Judul : *${title_romaji}*\n❏ Similarity : *${(100*similarity).toFixed(1)}%*\n❏ Episode : *${episode.toString()}*\n❏ Ecchi : *${is_adult?"Yes":"No"}*\n`.trim();conn.sendFile(m.chat,link,"srcanime.mp4",`${nobuyaki}`,m)};handler.help=["wait (caption|reply image)"],handler.tags=["tools"],handler.command=/^(wait)$/i;export default handler;