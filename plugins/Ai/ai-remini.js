// Klo mau pake, pake aja ini bkn enc cma terser aja

import FormData from"form-data";import Jimp from"jimp";async function processing(urlPath,method){return new Promise((async(resolve,reject)=>{let Methods=["enhance","recolor","dehaze"];Methods.includes(method)||(method=Methods[0]);let Form=new FormData,scheme="https://inferenceengine.vyro.ai/"+method;Form.append("model_version",1,{"Content-Transfer-Encoding":"binary",contentType:"multipart/form-data; charset=uttf-8"}),Form.append("image",Buffer.from(urlPath),{filename:"enhance_image_body.jpg",contentType:"image/jpeg"}),Form.submit({url:scheme,host:"inferenceengine.vyro.ai",path:"/"+method,protocol:"https:",headers:{"User-Agent":"okhttp/4.9.3",Connection:"Keep-Alive","Accept-Encoding":"gzip"}},(function(err,res){err&&reject();let data=[];res.on("data",(function(chunk,resp){data.push(chunk)})).on("end",(()=>{resolve(Buffer.concat(data))})),res.on("error",(e=>{reject()}))}))}))}let handler=async(m,{conn:conn,usedPrefix:usedPrefix,command:command})=>{switch(command){case"remini":{if(conn.enhancer=conn.enhancer?conn.enhancer:{},m.sender in conn.enhancer)throw"Masih Ada Proses Yang Belum Selesai Kak, Silahkan Tunggu Sampai Selesai Yah >//<";let q=m.quoted?m.quoted:m,mime=(q.msg||q).mimetype||q.mediaType||"";if(!mime)throw"Fotonya Mana Kak?";if(!/image\/(jpe?g|png)/.test(mime))throw`Mime ${mime} tidak support`;conn.enhancer[m.sender]=!0,m.reply("Proses Kak...");let error,img=await(q.download?.());try{const This=await processing(img,"enhance");conn.sendFile(m.chat,This,"","Sudah Jadi Kak >//<",m)}catch(er){error=!0}finally{error&&m.reply("Proses Gagal :("),delete conn.enhancer[m.sender]}}break;case"color":{if(conn.recolor=conn.recolor?conn.recolor:{},m.sender in conn.recolor)throw"Masih Ada Proses Yang Belum Selesai Kak, Silahkan Tunggu Sampai Selesai Yah >//<";let q=m.quoted?m.quoted:m,mime=(q.msg||q).mimetype||q.mediaType||"";if(!mime)throw"Fotonya Mana Kak?";if(!/image\/(jpe?g|png)/.test(mime))throw`Mime ${mime} tidak support`;conn.recolor[m.sender]=!0,m.reply("Proses Kak...");let error,img=await(q.download?.());try{const This=await processing(img,"enhance");conn.sendFile(m.chat,This,"","Sudah Jadi Kak >//<",m)}catch(er){error=!0}finally{error&&m.reply("Proses Gagal :("),delete conn.recolor[m.chat]}}break;case"hdr":{if(conn.hdr=conn.hdr?conn.hdr:{},m.sender in conn.hdr)throw"Masih Ada Proses Yang Belum Selesai Kak, Silahkan Tunggu Sampai Selesai Yah >//<";let q=m.quoted?m.quoted:m,mime=(q.msg||q).mimetype||q.mediaType||"";if(!mime)throw"Fotonya Mana Kak?";if(!/image\/(jpe?g|png)/.test(mime))throw`Mime ${mime} tidak support`;conn.hdr[m.sender]=!0,m.reply("Proses Kak...");let error,img=await(q.download?.());try{const This=await processing(img,"enhance");conn.sendFile(m.chat,This,"","Sudah Jadi Kak >//<",m)}catch(er){error=!0}finally{error&&m.reply("Proses Gagal :("),delete conn.hdr[m.sender]}}}};handler.help=["remini"],handler.tags=["ai"],handler.limit=!0,handler.command=["remini"];export default handler;