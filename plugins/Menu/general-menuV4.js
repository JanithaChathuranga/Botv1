// Klo mau pake, pake aja ini bkn enc cma terser aja

import jimp from"jimp";import fs from"fs";import fetch from"node-fetch";import PhoneNumber from"awesome-phonenumber";import moment from"moment-timezone";let tags={};const defaultMenu={before:"ㅤ\n┎─┨ *%name* ┠─┒\n┃ *STATUS▼*\n┃ ╭────────────╮\n┃ ╽ *Uptime*  : %uptime  \n┃ ┃ *Jam*        : %time     \n┃ ╿ *tanggal*  : %date\n┃ ╰────────────╯\n┃          \n┖─────────┚\nㅤㅤㅤ             %readmore\n",header:"≡ *%category*\n│",body:"│➤   %cmd",footer:"│\n┕━━━━━━━━\nㅤㅤㅤ",after:"*ᴊᴄ ᴍᴜʟᴛɪ ᴅᴇᴠɪᴄᴇ*"};let handler=async(m,{conn:conn,usedPrefix:_p,args:args,command:command})=>{try{let _uptime,name=m.pushName||conn.getName(m.sender),d=new Date(new Date+36e5),locale="id",date=d.toLocaleDateString(locale,{day:"numeric",month:"long",year:"numeric",timeZone:"Asia/Jakarta"}),time=d.toLocaleTimeString(locale,{timeZone:"Asia/Jakarta"});time=time.replace(/[.]/g,":"),process.send&&(process.send("uptime"),_uptime=1e3*await new Promise((resolve=>{process.once("message",resolve),setTimeout(resolve,1e3)})));let uptime=clockString(_uptime),help=Object.values(global.plugins).filter((plugin=>!plugin.disabled)).map((plugin=>({help:Array.isArray(plugin.tags)?plugin.help:[plugin.help],tags:Array.isArray(plugin.tags)?plugin.tags:[plugin.tags],prefix:"customPrefix"in plugin,limit:plugin.limit,premium:plugin.premium,enabled:!plugin.disabled}))),distance=(Object.keys(await conn.groupFetchAllParticipating()),Object.keys(await conn.chats),await conn.fetchBlocklist(),new Date("April 22, 2023 00:00:00")-(new Date).getTime());Math.floor(distance/864e5),Math.floor(distance%864e5/36e5),Math.floor(distance%36e5/6e4),Math.floor(distance%6e4/1e3),ucapan(),conn.getName(m.sender);for(let plugin of help)if(plugin&&"tags"in plugin)for(let tag of plugin.tags)!(tag in tags)&&tag&&(tags[tag]=tag);conn.menu=conn.menu?conn.menu:{};let before=conn.menu.before||defaultMenu.before,header=conn.menu.header||defaultMenu.header,body=conn.menu.body||defaultMenu.body,footer=conn.menu.footer||defaultMenu.footer,after=conn.menu.after||defaultMenu.after,_text=[before,...Object.keys(tags).map((tag=>header.replace(/%category/g,tags[tag].toUpperCase())+"\n"+[...help.filter((menu=>menu.tags&&menu.tags.includes(tag)&&menu.help)).map((menu=>menu.help.map((help=>body.replace(/%cmd/g,menu.prefix?help:"%p"+help).replace(/%islimit/g,menu.limit?"┣> Ⓛ":" ").replace(/%isPremium/g,menu.premium?"┣> Ⓟ":"").trim())).join("\n"))),footer].join("\n"))),after].join("\n"),text="string"==typeof conn.menu?conn.menu:"object"==typeof conn.menu?_text:"",replace={"%":"%",p:_p,uptime:uptime,me:conn.getName(conn.user.jid),name:name,date:date,time:time,readmore:readMore};m.sender.split`@`[0],m.chat,m.sender.split("@")[0],m.sender.split("@")[0];text=text.replace(new RegExp(`%(${Object.keys(replace).sort(((a,b)=>b.length-a.length)).join`|`})`,"g"),((_,name)=>""+replace[name]));await conn.profilePictureUrl(conn.user.jid,"image").catch((_=>"./src/avatar_contact.png")),pickRandom(["application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/pdf","application/vnd.android.package-archive","application/zip"]);await conn.relayMessage(m.chat,{requestPaymentMessage:{currencyCodeIso4217:"IDR",amount1000:10909143e3,requestFrom:m.sender,noteMessage:{extendedTextMessage:{text:text.trim(),contextInfo:{externalAdReply:{showAdAttribution:!0}}}}}},{})}catch(e){throw conn.reply(m.chat,"Maaf, menu sedang error",m),e}};handler.help=["mpay"],handler.tags=["main"],handler.command=/^(mpay)$/i,handler.register=!1;export default handler;const more=String.fromCharCode(8206),readMore=more.repeat(4001);function clockString(ms){return[isNaN(ms)?"--":Math.floor(ms/36e5),isNaN(ms)?"--":Math.floor(ms/6e4)%60,isNaN(ms)?"--":Math.floor(ms/1e3)%60].map((v=>v.toString().padStart(2,0))).join(":")}function pickRandom(list){return list[Math.floor(Math.random()*list.length)]}async function genProfile(conn,m){let font=await jimp.loadFont("./names.fnt"),mask=await jimp.read("https://i.imgur.com/552kzaW.png"),welcome=await jimp.read(thumbnailUrl.getRandom()),avatar=await jimp.read(await conn.profilePictureUrl(m.sender,"image").catch((()=>"https://telegra.ph/file/24fa902ead26340f3df2c.png"))),status=(await conn.fetchStatus(m.sender).catch(console.log)||{}).status?.slice(0,30)||"Not Detected";return await avatar.resize(460,460),await mask.resize(460,460),await avatar.mask(mask),await welcome.resize(welcome.getWidth(),welcome.getHeight()),await welcome.print(font,550,180,"Name:"),await welcome.print(font,650,255,m.pushName.slice(0,25)),await welcome.print(font,550,340,"About:"),await welcome.print(font,650,415,status),await welcome.print(font,550,500,"Number:"),await welcome.print(font,650,575,PhoneNumber("+"+m.sender.split("@")[0]).getNumber("international")),await welcome.composite(avatar,50,170).getBufferAsync("image/png")}function ucapan(){const hour_now=moment.tz("Asia/Jakarta").format("HH");return hour_now>="03"&&hour_now<="10"?"Ohayou...":hour_now>="10"&&hour_now<="15"||hour_now>="15"&&hour_now<="17"?"Konnichiwa...":hour_now>="17"&&hour_now<="18"||hour_now>="18"&&hour_now<="23"?"Konbanwa...":"Konbanwa"}